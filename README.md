# BeholderBot (Python 3.11)

Просто бот на питоне по фану без заморочек. 

Нужен для сбора личной статистики.

## Install linux

Тестировалось на python 3.10 и 3.11

1. Склонировать репозиторий в рабочую директорию бота
2. Создать виртуальное окружение:
   - `python3 -m venv /path/to/bot/venv`
   - `source /path/to/bot/venv/bin/acivate`
   - `python3 -m pip install -r /path/to/bot/requirments.txt`
   - `deactivate`
2. Перейти в `/etc/systemd/system/`
3. Создать файл `beholder_bot.service`
4. В файле прописать:
```
[Unit]
Description=Beholder Bot Python
After=network.target

[Service]
ExecStart=/bin/bash -c 'source /path/to/bot/venv/bin/activate && python3 /path/to/bot/main.py'
WorkingDirectory=/path/to/bot
Restart=always
User=root
Environment="BOT_TOKEN=<>"
Environment="BOT_CHAT_ID=<>"
Environment="BOT_REMINDER_DAY_TIME=23:00"
Environment="BOT_DATA_PATH=/home/data"

[Install]
WantedBy=multi-user.target
```
6. Сохранить и закрыть файл.
7. Обновить конфигурацию служб:
   - `sudo systemctl daemon-reload`
8. Перезапустить службу:
   - `sudo systemctl restart beholder_bot.service`

## Статусы дней

Нужно получать, хранить и визуализировать данные о том, как прошел день.

День может пройти:
- хорошо, было много энергии, хорошее настроение, день прошел продуктивно
- нормально, было мало энергии, настроение среднее, день прошел в принципе не зря
- плохо, энергии нет, настроение плохое, день прошел бездарно

Данные о прошедшем дне можно получить:
- спрашивая у пользователя раз в день, например, в 23:00
- пользователь сам может в любое время сообщить как прошел день и тогда спрашивать не надо

Пользователь может узнать:
- получить график результатов прошедших дней за все время

## Хранение данных

Как хранить данные?
- в csv. Две колонки: Date,Status. 
- Status принимает следующие значения:
  - 1, Good
  - 0, Normal
  - -1, Bad

## Bot API 

Даты и статусы:
- `/day [status]`
  - добавить статус в текущий день

Статистика и графики:
- `/graph`
  - получить картинку с графиком за все время

## Не забыть поправить
То, на что обратил внимание, но что пока лень/не нужно исправлять:
- тесты на csv_day_repository подразумевались, что каждый себе готовит csv, а потом удаляет.
  - но по факту все используют одну csv, которая сбрасывается перед запуском тестов
  - может в ногу выстрелить, но пока не стреляет
- в csv_day_repository pandas прокрался, избыточно как-то, надо выпилить
- про reminder:
  - нет тестов
  - не нравится, что он экземпляр Bot использует, у которого внутри http соединение. Надо исследовать поведение под нагрузкой
  - надо отвязать reminder от всех зависимостей, чтобы просто callback на вход принимал и время
  - используется csv репозиторий без блокировок
